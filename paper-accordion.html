<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-selector/iron-multi-selectable.html">

<!--
A wrapper for the Material Design [expansion panel with header and collapsible content](https://material.google.com/components/expansion-panels.html)

### Example

```html
<paper-accordion>
  <paper-expansion-panel header="Panel" summary="With event" on-toggle="onToggle">
    Lots of very interesting content.
  </paper-expansion-panel>
  <paper-expansion-panel header="Panel" summary="With event" on-toggle="onToggle">
    Lots of very interesting content.
  </paper-expansion-panel>
</paper-accordion
```

### Styling

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
--paper-accordion-divider|Mixin applied to the paper-expansion-panel items that need a divider|{}

@demo demo/index.html
-->
<dom-module id="paper-accordion">

	<template>

		<style>
			::slotted(paper-expansion-panel),
            ::slotted(paper-icon-expansion-panel) {
                background: #fff;
                box-shadow: 0 3px 1px -2px rgba(0,0,0,.2), 0 2px 2px 0 rgba(0,0,0,.14), 0 1px 5px 0 rgba(0,0,0,.12);
                transition: margin 225ms cubic-bezier(.4,0,.2,1);
                box-sizing: content-box;
                margin: 0;
            }
            /* ::slotted(paper-expansion-panel.divider){
                border-top: 1px solid rgba(0, 0, 0, var(--dark-divider-opacity, .12));

                @apply --paper-accordion-divider;
            } */

            ::slotted(paper-expansion-panel[opened]),
            ::slotted(paper-icon-expansion-panel[opened]){
                margin-top: 16px;
                margin-bottom: 16px;
            }

            ::slotted(paper-expansion-panel[opened]:first-child),
            ::slotted(paper-icon-expansion-panel[opened]:first-child){
                margin-top: 0;
            }

            ::slotted(paper-expansion-panel[opened]:last-child),
            ::slotted(paper-icon-expansion-panel[opened]:last-child){
                margin-bottom: 0;
            }
        </style>
        <slot id="slot" on-slotchange="_onSlotChange"></slot>
	</template>
</dom-module>

<script>

(function() {

	Polymer({
		is: 'paper-accordion',
		properties: {
            /**
			 * Allow multiple items to be open.
			 */
            multiOpen: {
                type: Boolean,
                value: false
            }
		},
        behaviors: [Polymer.IronMultiSelectableBehavior],

        listeners: {
          'toggle': '_onToggle',
          'slotchange': '_onSlotChange'
        },

        _setDividers: function() {
            const expansionPanels = this.$.slot.assignedNodes()
                    .filter(n => n.nodeType === Node.ELEMENT_NODE && 
                        (n.nodeName === "PAPER-EXPANSION-PANEL" || n.nodeName === "PAPER-ICON-EXPANSION-PANEL"));

            let previousPanel;

            for (let i = 0; i < expansionPanels.length; i++) {
                let panel = expansionPanels[i];

                panel.classList.remove("divider");

                if (previousPanel && !previousPanel.opened && !panel.opened) {
                    panel.classList.add("divider");
                }

                previousPanel = panel;
            }
        },

        _onToggle: function(e){
            if(!this.multiOpen && e.detail.opened) {
                // Collapse others
                const otherExpansionPanels = this.$.slot.assignedNodes()
                    .filter(n => n.nodeType === Node.ELEMENT_NODE && 
                        n !== e.detail && 
                        (n.nodeName === "PAPER-EXPANSION-PANEL" || n.nodeName === "PAPER-ICON-EXPANSION-PANEL"));

                otherExpansionPanels.forEach(n => n.opened = false);
            }

            this._setDividers();
        },

        _onSlotChange: function(e){
            this._setDividers();
        }

	});

})();

</script>
